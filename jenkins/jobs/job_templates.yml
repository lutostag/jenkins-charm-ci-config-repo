- scm:
    name: jenkins-charm
    scm:
      - git:
         url: https://github.com/lutostag/layer-jenkins.git
         branches:
          - origin/built

- scm:
    name: jenkins-bundle
    scm:
      - git:
         url: https://github.com/lutostag/jenkins-bundle-example.git
         branches:
          - origin/self-ci

- scm:
    name: bundle-and-deps
    scm:
      - jenkins-bundle
      - jenkins-charm

- job:
    name: deploy-bundle-test
    scm:
        - bundle-and-deps
    concurrent: false
    triggers:
        - pollscm:
            cron: "* * * * *"
    wrappers:
        - timeout:
            timeout: 1380
            fail: true
    builders:
        - shell: /etc/ci-configurator/ci-config/jenkins/jobs/deploy.sh

- job:
    name: self-update
    concurrent: false
    triggers:
        - build-result:
            cron: '* * * * *'
            groups:
              - jobs:
                  - deploy-bundle-test
    wrappers:
        - timeout:
            timeout: 1440
            fail: true
    builders:
        - shell: /etc/ci-configurator/ci-config/jenkins/jobs/self-update.sh
